---
output: github_document
always_allow_html: yes
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
options(width = 130)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# dscore

<!-- badges: start -->
<!-- badges: end -->

The `dscore` package contains tools to

- Calculate D-score from item level responses
- Transform the D-scores into DAZ, age-standardised Z-scores

The required input consists of *item level* responses on milestones
from widely used instruments for measuring child development.

## Installation

You can install the released version of dscore from [CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("dscore")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("stefvanbuuren/dscore")
```

## Example

### Inspect the data

The `milestones` dataset in the `dscore` package contain responses
of 27 preterm children measured at various age between birth and 2.5 
years on the Dutch Development Instrument (DDI). The dataset looks 
like:

```{r milestones}
library(dscore)
head(milestones[, c(1, 3, 4, 9:15)])
```

Each row corresponds to a visit. Most children have three or four visits.
Columns starting with `ddi` hold the responses on DDI-items. A 
`1` means a PASS, a `0` means a FAIL, and `NA` means that the item was 
not administered.

The `get_labels()` function obtains the labels of the milestones, e.g.,

```{r}
items <- names(milestones)[9:15]
labels <- get_labels(items)
print(data.frame(items, labels), right = FALSE, row.names = FALSE)
```

### Calculate the D-score and DAZ

The `milestones` dataset has properly named columns that identifies each
item. Calculating the D-score and DAZ is then done by:

```{r}
ds <- dscore(milestones)
dim(ds)
```

where `ds` is a `data.frame` with the same number of rows than the input 
data. The first six rows are

```{r}
head(ds)
```

The table below provides the interpretation of each column: 

Name | Interpretation
---- | -------------
a    | Decimal age
n    | Number of items used to calculate D-score
p    | Percentage of passed milestones
d    | D-score estimate, mean of posterior
sem  | Standard error of measurement, standard deviation of the posterior
daz  | D-score corrected for age

### Graphs of D-score and DAZ

The `milestones` data and the result can be combined as

```{r}
md <- cbind(milestones, ds)
```

The individual developmental curves of 27 children can be plotted.

```{r graphD, dpi = 144}
library(ggplot2)
ggplot(md, aes(x = a, y = d, group = id, color = sex)) + 
  xlab("Age (in years)") + 
  ylab("D-score") +
  geom_line(lwd = 0.1) +
  geom_point(size = 1) +
  scale_fill_discrete(palette = "Dark2") +
  theme_light()
```

The DAZ is an age-standardized D-score with a standard normal distribution
with mean 0 and variance 1. The individual DAZ curves are plotted as

```{r graphDAZ, dpi = 144}
ggplot(md, aes(x = a, y = daz, group = id, color = sex)) + 
  theme_light() +
  geom_rect(xmin = 0, xmax = 3, ymin = -2, ymax = 2, 
            fill = "grey97", linetype = 0, show.legend = FALSE) +
  geom_hline(yintercept = -1:1, colour = "white", lwd = 0.5) +
  coord_cartesian(ylim = c(-4, 4)) +
  geom_line(lwd = 0.1) +
  geom_point(size = 1) +
  scale_fill_discrete(palette = "Dark2") +
  xlab("Age (in years)") +
  ylab("DAZ")
```

### Tools for item names


