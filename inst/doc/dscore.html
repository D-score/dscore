<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Stef van Buuren" />

<meta name="date" content="2018-01-14" />

<title>Calculate D-score and DAZ</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Calculate D-score and DAZ</h1>
<h4 class="author"><em>Stef van Buuren</em></h4>
<h4 class="date"><em>2018-01-14</em></h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The D-score is a one-number summary measure of early child development. This vignettes shows how to estimate the D-score and the D-score SDS (also known as <em>D-score Age adjusted Z-score</em>, or DAZ) from individual pass/fail data. The vignettes covers some typical actions needed when estimating D-scores:</p>
<ol style="list-style-type: decimal">
<li>Rename item names in source data to item names used in itembank;</li>
<li>Reorganize the source data into a long matrix;</li>
<li>Calculate D-score and DAZ;</li>
<li>Combine D-score and DAZ with source data.</li>
</ol>
</div>
<div id="rename-item-names" class="section level2">
<h2>1. Rename item names</h2>
<p>The <code>dscore</code> package has built-in subset of data from the POPS study <span class="citation">(Verloove-Vanhorick et al. 1986)</span>. The dataset is called <code>popsdemo</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;dscore&quot;</span>)

<span class="kw">head</span>(popsdemo[, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>], <span class="dv">5</span>)</code></pre></div>
<pre><code>##   patid gender gestationalage moment age occ daycor Fixateseyes Reactstospeech
## 1 11126      1       31.14286      2 161   1    103           1              1
## 2 11126      1       31.14286      3 231   2    172          NA             NA
## 3 11126      1       31.14286      4 378   3    319          NA             NA
## 4 11126      1       31.14286      5 819   4    762          NA             NA
## 5 12989      1       34.00000      2 140   1     99           1              1
##   Movesbotharmsequallyasmuch
## 1                          1
## 2                         NA
## 3                         NA
## 4                         NA
## 5                          1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(popsdemo)</code></pre></div>
<pre><code>## [1] 100</code></pre>
<p>There are 25 children, with four time points each. The names of the items that form the entire test are obtained from columns 8-64.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">items &lt;-<span class="st"> </span><span class="kw">names</span>(popsdemo)[<span class="dv">8</span><span class="op">:</span><span class="dv">64</span>]</code></pre></div>
<p>The names of the items in the data need to be matched against one of the lexicons in the item bank. The item bank in the <code>dscore</code> package is called <code>itembank</code>. For each item, the item bank contains:</p>
<ol style="list-style-type: decimal">
<li>The name of the item according to some lexicon (i.e. naming system);</li>
<li>The visit number (<code>occ</code>) according to the Dutch child health care system;</li>
<li>The label of the item, both in English and Dutch;</li>
<li>The difficulty level of the item, as estimated by the Rasch model <span class="citation">(Buuren 2014)</span>.</li>
</ol>
<p>The built-in lexicons are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(itembank)[<span class="kw">grep</span>(<span class="st">&quot;lex_&quot;</span>, <span class="kw">names</span>(itembank))]</code></pre></div>
<pre><code>## [1] &quot;lex_dutch1996&quot; &quot;lex_dutch2005&quot; &quot;lex_dutch1983&quot; &quot;lex_smocc&quot;    
## [5] &quot;lex_ghap&quot;      &quot;lex_gcdg&quot;</code></pre>
<p>We first need to find out a proper lexicon for the data. The POPS data are already coded in the <code>lex_ghap</code> lexicon. We may verify the item names in the data against the item names in the item bank.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">itemset &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(itembank<span class="op">$</span>lex_dutch1983)
<span class="kw">head</span>(<span class="kw">cbind</span>(items, itembank[itemset, <span class="kw">c</span>(<span class="st">&quot;lex_ghap&quot;</span>)]))</code></pre></div>
<pre><code>##      items                                  
## [1,] &quot;Fixateseyes&quot;                &quot;GSFIXEYE&quot;
## [2,] &quot;Reactstospeech&quot;             &quot;GSRSPCH&quot; 
## [3,] &quot;Movesbotharmsequallyasmuch&quot; &quot;GSMARM&quot;  
## [4,] &quot;Movesbothlegsequallyasmuch&quot; &quot;GSMLEG&quot;  
## [5,] &quot;Liftschin&quot;                  &quot;GSLFCHIN&quot;
## [6,] &quot;Smilesback&quot;                 &quot;GSSMILE&quot;</code></pre>
<p>In this case all item names from the source data and the item bank match up exactly, but in general, we will need to map carefully the names in the dataset to the names in one of the lexicons provided by the item bank.</p>
<p>For POPS, we may take out the relevant parts of the item bank as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ib &lt;-<span class="st"> </span>itembank[itemset,<span class="kw">c</span>(<span class="st">&quot;lex_dutch1983&quot;</span>, <span class="st">&quot;lex_ghap&quot;</span>, <span class="st">&quot;labelEN&quot;</span>, <span class="st">&quot;tau&quot;</span>)]
<span class="kw">head</span>(ib, <span class="dv">3</span>)</code></pre></div>
<pre><code>##   lex_dutch1983 lex_ghap                 labelEN  tau
## 1            v1 GSFIXEYE             Eyes Fixate  5.4
## 2            v2  GSRSPCH   Reacts when spoken to  1.7
## 3            v3   GSMARM Moves arms equally well -2.2</code></pre>
<p>From here on, we will work in the GHAP lexicon. Renaming the source data is now done by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">item_locations &lt;-<span class="st"> </span><span class="kw">names</span>(popsdemo) <span class="op">%in%</span><span class="st"> </span>items
<span class="kw">names</span>(popsdemo)[item_locations] &lt;-<span class="st"> </span><span class="kw">as.character</span>(ib<span class="op">$</span>lex_ghap)</code></pre></div>
<p>The source data has now names that are recognized in the itembank. To check this, find the difficulties for each item by the <code>gettau()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">gettau</span>(<span class="dt">items =</span> <span class="kw">names</span>(popsdemo)[item_locations])</code></pre></div>
<pre><code>## GSFIXEYE  GSRSPCH   GSMARM   GSMLEG GSLFCHIN  GSSMILE   GSFEYE  GSHOPEN 
##      5.4      1.7     -2.2     -1.9      5.2     11.3     14.5     16.5 
##   GSLKHN  GSVOCAL     GSRP   GSHH45 GSHPLAYM    GSGRP GSNOHLAG  GSTHEAD 
##     20.7     14.5     15.8     20.0     28.2     29.9     26.0     31.1 
##  GSLBEND   GSHH90   GSTTOY   GSPTOY   GSPLFT  GSROLLS  GSHHSIT  GSSITST 
##     25.7     27.8     36.0     36.5     33.2     34.7     32.5     34.9 
##   GSSAYS  GSSITWS   GSPICK  GSCRAWL GSPULLST  GSWAVES GSJABBER   GSGETC 
##     36.0     40.0     43.1     43.1     44.3     43.1     40.9     46.0 
## GSPLAYGT  GSCRBLY  GSWALKS GSSIMPLE GSTWOWRD  GSMK2CB  GSEXPLR GSTHRWRD 
##     46.5     46.1     46.1     45.7     50.1     56.4     46.9     53.2 
##  GSIDOBJ GSWLKOWN  GSTBALL  GSMK3CB GSIMITAT GSDRNKCP GSTWOSEN GSPUTBAL 
##     55.4     51.9     56.0     59.2     52.3     58.5     60.2     57.8 
##   GSPKSQ  GSWLKWH  GSMKTW6 GSPUTFIG  GSTKCLO GSEATSPN  GSREFER GSID5OBJ 
##     55.3     55.5     62.6     60.3     60.6     58.5     61.7     62.2 
##    GSKIK 
##     64.2</code></pre>
</div>
<div id="reorganize-the-data-into-a-long-matrix" class="section level2">
<h2>2. Reorganize the data into a long matrix</h2>
<p>The <code>dscore()</code> function takes vectors of item scores, item names and ages. Rearringing the data makes it easy to extract the relevant vectors. We need to create a data set with the following variables: <code>patid</code>, <code>moment</code>, <code>age</code>, <code>daycor</code>, <code>item</code> and <code>score</code>, and select only the rows where we have an observed score.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)
data &lt;-<span class="st"> </span>popsdemo <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(patid, moment, age, daycor, GSFIXEYE<span class="op">:</span>GSKIK) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(items, scores, GSFIXEYE<span class="op">:</span>GSKIK, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(patid, moment)
<span class="kw">head</span>(data)</code></pre></div>
<pre><code>##   patid moment age daycor    items scores
## 1 11126      2 161    103 GSFIXEYE      1
## 2 11126      2 161    103  GSRSPCH      1
## 3 11126      2 161    103   GSMARM      1
## 4 11126      2 161    103   GSMLEG      1
## 5 11126      2 161    103 GSLFCHIN      1
## 6 11126      2 161    103  GSSMILE      1</code></pre>
<p>There are 1385 records with a nonmissing item score.</p>
</div>
<div id="calculate-d-score-and-daz" class="section level2">
<h2>3. Calculate D-score and DAZ</h2>
<p>For illustration, let us first calculate the D-score of the first child, with ID 11126. There are 75 scores for this child, spread over four time points. This is a preterm child, so we correct calener age for gestational age as in <code>daycor</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">child1 &lt;-<span class="st"> </span><span class="kw">filter</span>(data, patid <span class="op">==</span><span class="st"> </span><span class="dv">11126</span>)

scores &lt;-<span class="st"> </span>child1<span class="op">$</span>scores
items &lt;-<span class="st"> </span><span class="kw">as.character</span>(child1<span class="op">$</span>items)
ages &lt;-<span class="st"> </span><span class="kw">round</span>(child1<span class="op">$</span>daycor<span class="op">/</span><span class="fl">365.25</span>, <span class="dv">4</span>)

<span class="co"># calculate dscore and daz for each time point for given child</span>
(d &lt;-<span class="st"> </span><span class="kw">dscore</span>(scores, items, ages))</code></pre></div>
<pre><code>##  0.282 0.4709 0.8734 2.0862 
##  20.94  35.32  46.72  60.90</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">daz</span>(d)</code></pre></div>
<pre><code>##  0.282 0.4709 0.8734 2.0862 
## -1.521  0.383  0.212 -1.291</code></pre>
<p>If desired, one may also back-calculate the D-score from the standard deviation score by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">zad</span>(<span class="kw">daz</span>(d))</code></pre></div>
<pre><code>##  0.282 0.4709 0.8734 2.0862 
##  20.94  35.32  46.72  60.90</code></pre>
<p>If we specify the child identifier  as a by-group variable, we may calculate the D-score and DAZ for all children by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># use age corrected for gestational age</span>
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(data)
data<span class="op">$</span>ages &lt;-<span class="st"> </span><span class="kw">round</span>(data<span class="op">$</span>daycor<span class="op">/</span><span class="fl">365.25</span>, <span class="dv">4</span>)

<span class="co"># calculate D-score and DAZ</span>
ds &lt;-<span class="st"> </span><span class="kw">split</span>(data, data<span class="op">$</span>patid)
dl &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">mclapply</span>(ds, <span class="dt">FUN =</span> dscore)
dazl &lt;-<span class="st"> </span><span class="kw">lapply</span>(dl, <span class="dt">FUN =</span> daz)
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">patid =</span> <span class="kw">rep</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(dl)), <span class="dt">times =</span> <span class="kw">unlist</span>(<span class="kw">lapply</span>(dl, length))),
  <span class="dt">ages =</span> <span class="kw">as.numeric</span>(<span class="kw">unlist</span>(<span class="kw">lapply</span>(dl, names))),
  <span class="dt">dscore =</span> <span class="kw">as.numeric</span>(<span class="kw">unlist</span>(dl)),
  <span class="dt">daz =</span> <span class="kw">as.numeric</span>(<span class="kw">unlist</span>(dazl)))
<span class="kw">head</span>(df)</code></pre></div>
<pre><code>##   patid   ages dscore    daz
## 1 11126 0.2820  20.94 -1.521
## 2 11126 0.4709  35.32  0.383
## 3 11126 0.8734  46.72  0.212
## 4 11126 2.0862  60.90 -1.291
## 5 12989 0.2710  20.90 -1.361
## 6 12989 0.4873  30.62 -1.369</code></pre>
</div>
<div id="combine-d-score-and-daz-with-source-data" class="section level2">
<h2>4. Combine D-score and DAZ with source data</h2>
<p>Finally, in order to do further analyses, we need to put the estimated D-score and DAZ back into the source data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># merge dscore and daz into popsdemo data</span>
popsdemo<span class="op">$</span>ages &lt;-<span class="st"> </span><span class="kw">round</span>(popsdemo<span class="op">$</span>daycor<span class="op">/</span><span class="fl">365.25</span>, <span class="dv">4</span>)
popsdemo &lt;-<span class="st"> </span><span class="kw">merge</span>(popsdemo, df, <span class="dt">all.x =</span> <span class="ot">TRUE</span>)
<span class="kw">head</span>(<span class="kw">select</span>(popsdemo, patid, moment, ages, dscore, daz))</code></pre></div>
<pre><code>##   patid moment   ages dscore    daz
## 1 11126      2 0.2820  20.95     NA
## 2 11126      3 0.4709  35.32  0.383
## 3 11126      4 0.8734  46.72  0.212
## 4 11126      5 2.0862  60.90 -1.291
## 5 12989      2 0.2710  20.90 -1.361
## 6 12989      3 0.4873  30.62 -1.369</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-vanbuuren2014gc">
<p>Buuren, S van. 2014. “Growth Charts of Human Development.” <em>Stat Methods Med Res</em> 23 (4). Netherlands Organisation for Applied Scientific Research TNO, Leiden, The Netherlands Department of Methodology; Statistics, FSS, University of Utrecht, The Netherlands stef.vanbuuren@tno.nl.: 346–68.</p>
</div>
<div id="ref-verloove-vanhorick1986">
<p>Verloove-Vanhorick, S. P., R. A. Verwey, R. Brand, J. Bennebroek Gravenhorst, M. J. N. C. Keirse, and J. H. Ruys. 1986. “Neonatal Mortality Risk in Relation to Gestational Age and Birthweight. Results of a National Survey of Preterm and Very-Low-Birthweight Infants in the Netherlands.” <em>Lancet</em> 1 (8472): 55–57.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
